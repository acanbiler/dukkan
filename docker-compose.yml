version: '3.8'

services:
  # PostgreSQL Database
  postgres:
    image: postgres:17-alpine
    container_name: dukkan-postgres
    environment:
      POSTGRES_USER: dukkan
      POSTGRES_PASSWORD: dukkan123
      POSTGRES_MULTIPLE_DATABASES: dukkan_product,dukkan_user,dukkan_order
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./docker/postgres/init-multiple-databases.sh:/docker-entrypoint-initdb.d/init-multiple-databases.sh
    networks:
      - dukkan-network
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U dukkan"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Product Service (will be uncommented when JAR is built)
  # product-service:
  #   build:
  #     context: ./backend/product-service
  #     dockerfile: ../../docker/product-service/Dockerfile
  #   container_name: dukkan-product-service
  #   environment:
  #     DB_HOST: postgres
  #     DB_PORT: 5432
  #     DB_NAME: dukkan_product
  #     DB_USER: dukkan
  #     DB_PASSWORD: dukkan
  #   ports:
  #     - "8081:8081"
  #   depends_on:
  #     postgres:
  #       condition: service_healthy
  #   networks:
  #     - dukkan-network

  # API Gateway (will be uncommented when JAR is built)
  # api-gateway:
  #   build:
  #     context: ./backend/api-gateway
  #     dockerfile: ../../docker/api-gateway/Dockerfile
  #   container_name: dukkan-api-gateway
  #   environment:
  #     PRODUCT_SERVICE_URL: http://product-service:8081
  #     ALLOWED_ORIGINS: http://localhost:5173,http://localhost:3000
  #   ports:
  #     - "8080:8080"
  #   depends_on:
  #     - product-service
  #   networks:
  #     - dukkan-network

  # Frontend (will be uncommented when built)
  # frontend:
  #   build:
  #     context: ./frontend
  #     dockerfile: ../docker/frontend/Dockerfile
  #   container_name: dukkan-frontend
  #   environment:
  #     VITE_API_BASE_URL: http://localhost:8080/api/v1
  #   ports:
  #     - "5173:5173"
  #   depends_on:
  #     - api-gateway
  #   networks:
  #     - dukkan-network

networks:
  dukkan-network:
    driver: bridge

volumes:
  postgres_data:
